#-------------------------------------------------------------------------------
# Build system for JS/CC LALR(1) Parser Generator
# Copyright (C) 2007-2012 by Phorward Software Technologies, Jan Max Meyer
#
# You may use, modify and distribute this software under the terms and
# conditions of the BSD license. Please see LICENSE for more information.
#
# Platform:			Node.js
#-------------------------------------------------------------------------------
# HOW TO:
#
# JS/CC has been tested with Rhino 1.6R7 and newer on Windows, Mac OSX,
# and Linux.
#
# *** To build JS/CC for Node.js, change to src directory and type
#
#     make -f Makefile.node
#-------------------------------------------------------------------------------

PLATFORM		=	node
NODE			=	node
JSCC			=	../jscc.js

include sources.inc
include tools.inc

all: 			$(JSCC) clean
	@echo
	@echo --- Compilation succeeded! ---

driver: ../driver_$(PLATFORM).js_
	@echo
	@echo --- Parser template generated! ---

../driver_$(PLATFORM).js_:		driver/driver_$(PLATFORM).js driver/parser.js
	cat driver/driver_$(PLATFORM).js driver/parser.js >../driver_$(PLATFORM).js_

$(JSCC):		$(SRC_FINAL)
	cat $(SRC_FINAL) >$@

$(SRC_PARSE_JS):$(SRC_PARSE)
	$(NODE) $(JSCC_BOOTSTRAP) -o $@ -p jscc -t ../driver_$(PLATFORM).js_ $?

$(SRC_REGEX_JS):$(SRC_REGEX)
	$(NODE) $(JSCC_BOOTSTRAP) -o $@ -p regex -t ../driver_$(PLATFORM).js_ $?

clean:
	-rm $(SRC_PARSE_JS)
	-rm $(SRC_REGEX_JS)

bootstrap:			all
	cp $(JSCC) $(JSCC_BOOTSTRAP)
	@echo
	@echo --- Bootstrap replaced ---
